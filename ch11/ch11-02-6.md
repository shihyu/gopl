### 11.2.6. 避免脆弱的測試

如果一個應用程序對於新出現的但有效的輸入經常失敗說明程序容易出bug（不夠穩健）；同樣，如果一個測試僅僅對程序做了微小變化就失敗則稱為脆弱。就像一個不夠穩健的程序會挫敗它的用戶一樣，一個脆弱的測試同樣會激怒它的維護者。最脆弱的測試代碼會在程序沒有任何變化的時候產生不同的結果，時好時壞，處理它們會耗費大量的時間但是並不會得到任何好處。

當一個測試函數會產生一個複雜的輸出如一個很長的字符串、一個精心設計的數據結構或一個文件時，人們很容易想預先寫下一系列固定的用於對比的標杆數據。但是隨著項目的發展，有些輸出可能會發生變化，儘管很可能是一個改進的實現導致的。而且不僅僅是輸出部分，函數複雜的輸入部分可能也跟著變化了，因此測試使用的輸入也就不再有效了。

避免脆弱測試代碼的方法是隻檢測你真正關心的屬性。保持測試代碼的簡潔和內部結構的穩定。特別是對斷言部分要有所選擇。不要對字符串進行全字匹配，而是針對那些在項目的發展中是比較穩定不變的子串。很多時候值得花力氣來編寫一個從複雜輸出中提取用於斷言的必要信息的函數，雖然這可能會帶來很多前期的工作，但是它可以幫助迅速及時修復因為項目演化而導致的不合邏輯的失敗測試。

